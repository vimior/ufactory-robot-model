<html>
  <head>
    <title>XARM Model Example</title>
  </head>
  <body>
    <div id="model-wrapper">
      <div id="model-container"></div>
    </div>
    <script src="./static/js/three.js/three.js"></script>
    <script src="./static/js/three.js/loaders/STLLoader.js"></script>
    <script src="./static/js/three.js/controls/OrbitControls.js"></script>
    <script src="./XARMLoader.js"></script>
    <script>
      const three = {
        scene: null,
        camera: null,
        renderer: null,
        controls: null,
        baseTransformControls: null,
        gridHelper: null,
        lights: [],
      };
      const axis = 6;  // xarm axis, 5/6/7
      const curThreeModel = axis === 5 ? ThreeModel.XARM5 : axis === 6 ? ThreeModel.XARM6 : ThreeModel.XARM7;

      const joints = [0, 0, 0, 0, 0, 0, 0]; // xarm joints degree 

      function addCameras() {
        const halfSize = [window.innerWidth / 100, window.innerHeight / 100];
        ThreeModel.camera = ThreeModel.camera || new THREE.OrthographicCamera(-halfSize[0], halfSize[0], halfSize[1], -halfSize[1], -50, 50);
        ThreeModel.camera.position.set(3, 1, 3);
        ThreeModel.camera.zoom = ThreeModel.DEFAULT_CAMZOOM;
        ThreeModel.camera.lookAt(ThreeModel.scene.position);
      }
      function addModels() {
        ThreeModel.scene.add(curThreeModel.GROUPS[0]);
      }
      
      function addLights() {
        ThreeModel.light1 = ThreeModel.light1 || new THREE.PointLight(0xffffff, 1, 100);
        ThreeModel.light1.position.set(0, 0, 30);
        ThreeModel.light2 = ThreeModel.light2 || new THREE.PointLight(0xffffff, 1, 50);
        ThreeModel.light2.position.set(0, 0, -40);
        ThreeModel.light3 = ThreeModel.light3 || new THREE.PointLight(0xffffff, 1, 100);
        ThreeModel.light3.position.set(-20, 20, -10);
        ThreeModel.light4 = ThreeModel.light4 || new THREE.PointLight(0xffffff, 1, 100);
        ThreeModel.light4.position.set(20, -20, -10);
        ThreeModel.light5 = ThreeModel.light5 || new THREE.PointLight(0xffffff, 1, 50);
        ThreeModel.light5.position.set(0, 40, -10);
        ThreeModel.scene.add(ThreeModel.light1);
        ThreeModel.scene.add(ThreeModel.light2);
        ThreeModel.scene.add(ThreeModel.light3);
        ThreeModel.scene.add(ThreeModel.light4);
        ThreeModel.scene.add(ThreeModel.light5);
      };
      function addGridHelpers() {
        ThreeModel.gridHelper = ThreeModel.gridHelper || new THREE.GridHelper(50, 50, 0xdddddd, 0xdddddd);
        ThreeModel.gridHelper.position.set(...ThreeModel.POSITION);
        ThreeModel.scene.add(ThreeModel.gridHelper);
      };
      function animate() {
        requestAnimationFrame( animate );
        curThreeModel.update(joints);
        ThreeModel.renderer.render( ThreeModel.scene, ThreeModel.camera );
        ThreeModel.controls.update();
      }
      function onWindowResize() {
        ThreeModel.camera.aspect = window.innerWidth / window.innerHeight;
        ThreeModel.camera.updateProjectionMatrix();
        ThreeModel.renderer.setSize( window.innerWidth, window.innerHeight);
      }

      ThreeModel.init(axis).then(() => {
        ThreeModel.scene = ThreeModel.scene || new THREE.Scene();

        addCameras();
        addLights();
        addModels();
        addGridHelpers();

        ThreeModel.renderer = ThreeModel.renderer || new THREE.WebGLRenderer( { antialias: true } );
        ThreeModel.renderer.setClearColor(0xffffff);
        ThreeModel.controls = ThreeModel.controls || new THREE.OrbitControls(ThreeModel.camera, ThreeModel.renderer.domElement);
        ThreeModel.controls = ThreeModel.controls;

        ThreeModel.controls.update();

        const container = document.getElementById('model-container');
        container.appendChild(ThreeModel.renderer.domElement);
        
        animate();
        onWindowResize();
        window.addEventListener('resize', onWindowResize, false);  
      });
    </script>
  </body>
</html>